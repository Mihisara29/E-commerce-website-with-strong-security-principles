<!DOCTYPE html>
<html>
<head>
    <title>Register & Cart</title>
    <style>
        button {
            margin: 5px;
        }
    </style>
</head>
<body>
<h2>Register User</h2>
<button id="registerBtn">Register Me</button>

<h2>Add Item to Cart</h2>
<form id="cartForm">
    <label>Product Name:</label>
    <input type="text" id="productName" required><br><br>

    <label>Quantity:</label>
    <input type="number" id="quantity" min="1" value="1" required><br><br>

    <button type="submit">Add to Cart</button>
</form>

<h2>Cart Items</h2>
<button id="viewCartBtn">View Cart</button>
<button id="clearCartBtn">Clear Cart</button>

<ul id="cartList"></ul>
<h3 id="responseMessage"></h3>

<script>
    const responseMessage = document.getElementById("responseMessage");
    const cartList = document.getElementById("cartList");

    // Register user
    document.getElementById('registerBtn').addEventListener('click', () => {
        fetch('/api/users/register', {
            method: 'POST',
            credentials: 'include',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                username: "testuser",
                name: "John Doe",
                contactNumber: "123456789",
                country: "Sri Lanka"
            })
        })
        .then(res => res.json())
        .then(data => {
            console.log("Register response:", data);
            alert("User registered! Check console for details.");
        })
        .catch(err => console.error("Error:", err));
    });

    // Add item to cart
    document.getElementById("cartForm").addEventListener("submit", function(event) {
        event.preventDefault();
        const productName = document.getElementById("productName").value;
        const quantity = parseInt(document.getElementById("quantity").value);

        fetch("/api/cart", {
            method: "POST",
            credentials: "include",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ productName, quantity })
        })
        .then(res => res.json())
        .then(data => {
            responseMessage.textContent = "Added to cart: " + JSON.stringify(data);
            // Optionally refresh cart automatically
            viewCart();
        })
        .catch(err => {
            responseMessage.textContent = "Error: " + err;
        });
    });

    // View cart function
    function viewCart() {
        fetch("/api/cart", {
            method: "GET",
            credentials: "include"
        })
        .then(res => res.json())
        .then(data => {
            cartList.innerHTML = ""; // clear list
            data.forEach(item => {
                const li = document.createElement("li");
                li.textContent = `${item.productName} - Quantity: ${item.quantity} `;

                // Create delete button for each item
                const deleteBtn = document.createElement("button");
                deleteBtn.textContent = "Delete";
                deleteBtn.style.marginLeft = "10px";
                deleteBtn.addEventListener("click", () => {
                    fetch(`/api/cart/${item.id}`, {
                        method: "DELETE",
                        credentials: "include"
                    })
                    .then(() => {
                        li.remove(); // remove item from UI
                        responseMessage.textContent = `Deleted ${item.productName} from cart`;
                    })
                    .catch(err => {
                        responseMessage.textContent = "Error deleting item: " + err;
                    });
                });

                li.appendChild(deleteBtn);
                cartList.appendChild(li);
            });
        })
        .catch(err => console.error("Error:", err));
    }

    // View cart button
    document.getElementById("viewCartBtn").addEventListener("click", viewCart);

    // Clear cart
    document.getElementById("clearCartBtn").addEventListener("click", () => {
        fetch("/api/cart/clear", {
            method: "DELETE",
            credentials: "include"
        })
        .then(() => {
            cartList.innerHTML = "";
            responseMessage.textContent = "Cart cleared!";
        })
        .catch(err => console.error("Error:", err));
    });
</script>
</body>
</html>
